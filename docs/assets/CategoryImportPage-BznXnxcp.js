import{_ as T,A as B,C as R,a as N,r as _,c as P,o as D,u as j,w as E,b,e as C,f as d,j as g,g as o,t as k,q as J,E as L,F as M,m as V,h as q,l as O,k as n}from"./index-BJw0gxFR.js";class z{async parse(l){try{const t=await this.readFileAsText(l);return{succeeded:!0,articles:JSON.parse(t).articles}}catch(t){const s="ファイルの読み込みに失敗しました。";return console.log(s,t),{succeeded:!1,exception:t,message:s}}}async readFileAsText(l){return await new Promise(t=>{const s=new FileReader;s.onload=()=>t(s.result),s.readAsText(l)})}}const G={key:1},H={class:"form-group"},K={class:"form-group"},Q=["disabled"],U={class:"articles-list"},W={key:0},X={key:1},Y={__name:"CategoryImportPage",setup(x){const l=new B,t=new R(l),s=new z,A=new N(l),S=new O(A,t),f=j(),r=_([]),m=_(null),p=_(null),i=_(null),h=P(()=>{const e=r.value?.length??0,a=(r.value?.filter(v=>!v.completed).length??0)<=0||i.value==null,u=e>0&&i.value!=null;return{disabled:a,visible:u}}),w=async()=>{m.value=await t.get(p.value)},F=async e=>{if(console.log(e.target.files[0]),i.value=e.target.files[0],i.value==null)return;const c=await s.parse(i.value);c.succeeded&&(r.value=c.articles.map(a=>({...a,completed:!1})))},I=()=>{r.value.filter(e=>!e.computed).forEach(async e=>{const{title:c,text:a,tags:u}=e;await S.set({categoryId:p.value,title:c,text:a,tags:u}),e.completed=!0})};return D(()=>{p.value=parseInt(f.params.id),w()}),E(()=>f.params.id,async e=>{p.value=parseInt(e),w()}),(e,c)=>{const a=g("TheSidebar"),u=g("NotFoundAlert"),v=g("TheMainLayout");return n(),b(v,{"main-panel-scroll":""},{sidebar:C(()=>[q(a)]),"panel-main":C(()=>[m.value==null?(n(),b(u,{key:0})):(n(),d("div",G,[o("h2",null,"記事を"+k(m.value.title)+"にインポート",1),o("fieldset",H,[o("input",{type:"file",accept:"application/json",onChange:F},null,32)]),o("fieldset",K,[J(o("button",{disabled:h.value.disabled,onClick:I}," 選択をインポート ",8,Q),[[L,h.value.visible]])]),o("div",U,[(n(!0),d(M,null,V(r.value,y=>(n(),d("div",{class:"article",key:y.id},[y.completed?(n(),d("span",W," 済 ")):(n(),d("span",X," － ")),o("div",null,k(y.title),1)]))),128))])]))]),_:1})}}},$=T(Y,[["__scopeId","data-v-3e9fbbf3"]]);export{$ as default};
