import{A as B,C as N,a as R,r as p,c as I,o as D,u as P,w as j,b as w,e as C,g as t,f as m,j as f,t as x,q as E,E as J,F as L,m as M,h as V,l as q,k as c,G}from"./index-C-CkPg3_.js";class O{async parse(l){try{const s=await this.readFileAsText(l);return{succeeded:!0,articles:JSON.parse(s).articles}}catch(s){const a="ファイルの読み込みに失敗しました。";return console.log(a,s),{succeeded:!1,exception:s,message:a}}}async readFileAsText(l){return await new Promise(s=>{const a=new FileReader;a.onload=()=>s(a.result),a.readAsText(l)})}}const z={class:"h-100"},H={key:1,class:"h-100"},K={class:"form-group"},Q={class:"custom-file b-form-file"},U={class:"d-flex"},W={class:"form-group ml-auto"},X=["disabled"],Y={class:"list-group"},Z={key:0,class:"badge bdge-info ml-auto"},ee={__name:"CategoryImportPage",setup(k){const l=new B,s=new N(l),a=new O,A=new R(l),S=new q(A,s),g=P(),r=p([]),_=p(null),d=p(null),i=p(null),y=I(()=>{const e=r.value?.length??0,o=(r.value?.filter(v=>!v.completed).length??0)<=0||i.value==null,u=e>0&&i.value!=null;return{disabled:o,visible:u}}),b=async()=>{_.value=await s.get(d.value)},F=async e=>{if(console.log(e.target.files[0]),i.value=e.target.files[0],i.value==null)return;const n=await a.parse(i.value);n.succeeded&&(r.value=n.articles.map(o=>({...o,completed:!1})))},T=()=>{r.value.filter(e=>!e.computed).forEach(async e=>{const{title:n,text:o,tags:u}=e;await S.set({categoryId:d.value,title:n,text:o,tags:u}),e.completed=!0})};return D(()=>{d.value=parseInt(g.params.id),b()}),j(()=>g.params.id,async e=>{d.value=parseInt(e),b()}),(e,n)=>{const o=f("TheSidebar"),u=f("NotFoundAlert"),v=f("TheMainLayout");return c(),w(v,{"main-panel-scroll":""},{sidebar:C(()=>[V(o)]),"panel-main":C(()=>[t("div",z,[_.value==null?(c(),w(u,{key:0})):(c(),m("div",H,[t("h2",null,"記事を"+x(_.value.title)+"にインポート",1),t("fieldset",K,[t("div",Q,[t("input",{type:"file",accept:"application/json",onChange:F},null,32)])]),t("div",U,[t("fieldset",W,[E(t("button",{disabled:y.value.disabled,class:"btn btn-primary",onClick:T}," 選択をインポート ",8,X),[[J,y.value.visible]])])]),t("div",Y,[(c(!0),m(L,null,M(r.value,h=>(c(),m("div",{class:"list-group-item d-flex",key:h.id},[t("div",null,x(h.title),1),h.completed?(c(),m("span",Z," 済 ")):G("",!0)]))),128))])]))])]),_:1})}}};export{ee as default};
