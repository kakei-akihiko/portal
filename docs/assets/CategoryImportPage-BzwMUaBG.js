import{_ as T,A as B,C as R,a as N,r as _,c as P,o as D,u as j,w as J,b,e as C,f,h as o,i as d,j as n,t as k,s as L,G as M,F as E,n as V,k as G,l as O}from"./index-CJk2SBmy.js";class q{async parse(l){try{const t=await this.readFileAsText(l);return{succeeded:!0,articles:JSON.parse(t).articles}}catch(t){const s="ファイルの読み込みに失敗しました。";return console.log(s,t),{succeeded:!1,exception:t,message:s}}}async readFileAsText(l){return await new Promise(t=>{const s=new FileReader;s.onload=()=>t(s.result),s.readAsText(l)})}}const z={key:1},H={class:"form-group"},K={class:"form-group"},Q=["disabled"],U={class:"articles-list"},W={key:0},X={key:1},Y={__name:"CategoryImportPage",setup(x){const l=new B,t=new R(l),s=new q,A=new N(l),S=new O(A,t),g=j(),r=_([]),m=_(null),p=_(null),i=_(null),h=P(()=>{const e=r.value?.length??0,a=(r.value?.filter(v=>!v.completed).length??0)<=0||i.value==null,u=e>0&&i.value!=null;return{disabled:a,visible:u}}),w=async()=>{m.value=await t.get(p.value)},F=async e=>{if(console.log(e.target.files[0]),i.value=e.target.files[0],i.value==null)return;const c=await s.parse(i.value);c.succeeded&&(r.value=c.articles.map(a=>({...a,completed:!1})))},I=()=>{r.value.filter(e=>!e.computed).forEach(async e=>{const{title:c,text:a,tags:u}=e;await S.set({categoryId:p.value,title:c,text:a,tags:u}),e.completed=!0})};return D(()=>{p.value=parseInt(g.params.id),w()}),J(()=>g.params.id,async e=>{p.value=parseInt(e),w()}),(e,c)=>{const a=f("TheSidebar"),u=f("NotFoundAlert"),v=f("TheMainLayout");return o(),b(v,{"main-panel-scroll":""},{sidebar:C(()=>[G(a)]),"panel-main":C(()=>[m.value==null?(o(),b(u,{key:0})):(o(),d("div",z,[n("h2",null,"記事を"+k(m.value.title)+"にインポート",1),n("fieldset",H,[n("input",{type:"file",accept:"application/json",onChange:F},null,32)]),n("fieldset",K,[L(n("button",{disabled:h.value.disabled,onClick:I}," 選択をインポート ",8,Q),[[M,h.value.visible]])]),n("div",U,[(o(!0),d(E,null,V(r.value,y=>(o(),d("div",{class:"article",key:y.id},[y.completed?(o(),d("span",W," 済 ")):(o(),d("span",X," － ")),n("div",null,k(y.title),1)]))),128))])]))]),_:1})}}},$=T(Y,[["__scopeId","data-v-3e9fbbf3"]]);export{$ as default};
